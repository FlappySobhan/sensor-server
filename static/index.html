<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø³Ù†Ø³ÙˆØ±Ù‡Ø§</title>
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ú¯Ù„Ø®Ø§Ù†Ù‡</h1>

    <!-- Cards -->
    <div class="cards">
      <div class="card">
        <h2>Ø¯Ù…Ø§ ğŸŒ¡ï¸</h2>
        <div id="temp" class="big">--</div>
      </div>
      <div class="card">
        <h2>Ø±Ø·ÙˆØ¨Øª ğŸ’§</h2>
        <div id="hum" class="big">--</div>
      </div>
      <div class="card">
        <h2>Ø±Ø·ÙˆØ¨Øª Ø®Ø§Ú© ğŸŒ</h2>
        <div id="soil" class="big">--</div>
      </div>
      <div class="card">
        <h2>Ù¾Ù…Ù¾ ğŸš°</h2>
        <div id="pump" class="big">--</div>
      </div>
      <div class="card">
        <h2>ÙÙ† ğŸŒ¬ï¸</h2>
        <div id="fan" class="big">--</div>
      </div>
    </div>

    <!-- Chart -->
    <div class="chart-wrap">
      <canvas id="chart"></canvas>
    </div>

    <!-- Table -->
    <h2>ğŸ“Š ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h2>
    <table>
      <thead>
        <tr>
          <th>Ø²Ù…Ø§Ù†</th>
          <th>Ø¯Ù…Ø§</th>
          <th>Ø±Ø·ÙˆØ¨Øª</th>
          <th>Ø®Ø§Ú©</th>
          <th>Ù¾Ù…Ù¾</th>
          <th>ÙÙ†</th>
        </tr>
      </thead>
      <tbody id="table-body">
      </tbody>
    </table>
  </div>

  <script>
    const API = "/data/all?key=shayan123";  // Ø§ÛŒÙ†Ø¬Ø§ ÛŒØ§Ø¯Øª Ø¨Ø§Ø´Ù‡ key Ù‡Ù…ÙˆÙ† API_KEY ØªÙˆ app.py Ù‡Ø³Øª

    let chart;
    function initChart() {
      const ctx = document.getElementById("chart").getContext("2d");
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            { label: "Ø¯Ù…Ø§", data: [], borderColor: "red", fill: false },
            { label: "Ø±Ø·ÙˆØ¨Øª", data: [], borderColor: "blue", fill: false }
          ]
        }
      });
    }

    async function loadData() {
      const res = await fetch(API);
      const data = await res.json();

      if (data.length === 0) return;

      // Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø§Ø¯Ù‡
      const latest = data[0];
      document.getElementById("temp").textContent = latest.temperature + " Â°C";
      document.getElementById("hum").textContent = latest.humidity + " %";
      document.getElementById("soil").textContent = latest.soil + " %";
      document.getElementById("pump").textContent = latest.pump_status ? "Ø±ÙˆØ´Ù†" : "Ø®Ø§Ù…ÙˆØ´";
      document.getElementById("fan").textContent = latest.fan_status ? "Ø±ÙˆØ´Ù†" : "Ø®Ø§Ù…ÙˆØ´";

      // Ø¬Ø¯ÙˆÙ„
      const tbody = document.getElementById("table-body");
      tbody.innerHTML = "";
      data.slice(0, 10).forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.timestamp}</td>
          <td>${row.temperature}</td>
          <td>${row.humidity}</td>
          <td>${row.soil}</td>
          <td>${row.pump_status ? "Ø±ÙˆØ´Ù†" : "Ø®Ø§Ù…ÙˆØ´"}</td>
          <td>${row.fan_status ? "Ø±ÙˆØ´Ù†" : "Ø®Ø§Ù…ÙˆØ´"}</td>
        `;
        tbody.appendChild(tr);
      });

      // Ú†Ø§Ø±Øª
      chart.data.labels = data.map(r => r.timestamp).reverse();
      chart.data.datasets[0].data = data.map(r => r.temperature).reverse();
      chart.data.datasets[1].data = data.map(r => r.humidity).reverse();
      chart.update();
    }

    initChart();
    loadData();
    setInterval(loadData, 5000);
  </script>
</body>
</html>
